syntax = "proto3";

package rooms_service;

// Il servizio deve permettere al client di:
// 1. ricevere aggiornamenti in real-time delle stanze
// 2. creare una nuova stanza
// 3. entrare/uscire da una stanza
// 4. conoscere il numero di partecipanti di una stanza

service RoomsService
{
	// Stream continuo di aggiornamenti in real-time delle stanze.
	// rpc WatchRoomsProcedure(WatchRoomsRequest) returns (stream RoomList) {}
 	// Il client manda una singola richiesta al server per ottenere la lista di tutte le stanze esistenti
 	// rpc ListAllRoomsProcedure(ListAllRoomsRequest) returns (RoomList) {}
	
  // Crea una nuova stanza
	rpc CreateRoomProcedure(CreateRoomProcedureRequest) returns (CreateRoomProcedureResponse);
	// Elimina una stanza
	rpc DeleteRoomProcedure(DeleteRoomProcedureRequest) returns (DeleteRoomProcedureResponse);
  // Ottenere la lista di tutte le stanze esistenti
  rpc ListRoomsProcedure(ListRoomsProcedureRequest) returns (ListRoomsProcedureResponse);
  
  // Entra in una stanza
  rpc JoinRoomProcedure(JoinRoomProcedureRequest) returns (JoinRoomProcedureResponse);
  // Esce da una stanza
  rpc LeaveRoomProcedure(LeaveRoomProcedureRequest) returns (LeaveRoomProcedureResponse);
  // Ritorna la lista degli utenti presenti in una stanza
  rpc ListRoomUsersProcedure(ListRoomUsersProcedureRequest) returns (ListRoomUsersProcedureResponse);
}

message RoomInfo
{
	uint32 room_id = 1;
	uint32 creator_id = 2;
	string room_name = 3;
	uint32 user_count = 4;
}
message ListRoomsProcedureRequest 
{}
message ListRoomsProcedureResponse 
{
  repeated RoomInfo rooms = 1;
}
message CreateRoomProcedureRequest
{
	uint32 creator_id = 1;
  string room_name = 2;
}
message CreateRoomProcedureResponse
{
  RoomInfo room = 1;
}
message DeleteRoomProcedureRequest
{
	uint32 room_id = 1;
	uint32 client_id = 2;
}
message DeleteRoomProcedureResponse
{}
message JoinRoomProcedureRequest
{
	uint32 client_id = 1;
  uint32 room_id = 2;
}
message JoinRoomProcedureResponse
{}
message LeaveRoomProcedureRequest
{
	uint32 client_id = 1;
  uint32 room_id = 2;
}
message LeaveRoomProcedureResponse
{}
message ListRoomUsersProcedureRequest
{
 	uint32 room_id = 1;
}
message ListRoomUsersProcedureResponse
{
	repeated uint32 client_ids = 1;
}