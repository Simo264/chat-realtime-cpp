syntax = "proto3";

package rooms_service;

// Il servizio deve permettere al client di:
// 1. ricevere aggiornamenti in real-time delle stanze
// 2. creare una nuova stanza
// 3. entrare/uscire da una stanza
// 4. conoscere il numero di partecipanti di una stanza

service RoomsService
{
  // Crea una nuova stanza
	rpc CreateRoomProcedure(CreateRoomProcedureRequest) returns (CreateRoomProcedureResponse);
	// Elimina una stanza
	rpc DeleteRoomProcedure(DeleteRoomProcedureRequest) returns (DeleteRoomProcedureResponse);
  // Entra in una stanza
  rpc JoinRoomProcedure(JoinRoomProcedureRequest) returns (JoinRoomProcedureResponse);
  // Esce da una stanza
  rpc LeaveRoomProcedure(LeaveRoomProcedureRequest) returns (LeaveRoomProcedureResponse);
  // Server-Side Streaming: il client chiama questo metodo e rimane in ascolto.
  // Serve per aggiornare il client sullo stato delle stanze: quante stanze ci sono, quali stanze,
  // quanti utenti per stanza.
  rpc WatchRoomsStreaming(WatchRoomsStreamingRequest) returns (stream WatchRoomsStreamingResponse);
  // Server-Side Streaming: il client chiama questo metodo e rimane in ascolto.
  // Serve per aggiornare in tempo reale sulla uscita e entrata di nuovi utenti nella stanza corrente e 
  // aggiornare la lista degli utenti presenti
  rpc WatchRoomUsersStreaming(WatchRoomUsersStreamingRequest) returns (stream WatchRoomUsersStreamingResponse);
}

message RoomInfo
{
	uint32 room_id = 1;
	uint32 creator_id = 2;
	string room_name = 3;
	uint32 user_count = 4;
}

message CreateRoomProcedureRequest
{
	uint32 creator_id = 1;
  string room_name = 2;
}
message CreateRoomProcedureResponse
{
  RoomInfo room = 1;
}
message DeleteRoomProcedureRequest
{
	uint32 room_id = 1;
	uint32 client_id = 2;
}
message DeleteRoomProcedureResponse
{}
message JoinRoomProcedureRequest
{
	uint32 client_id = 1;
  uint32 room_id = 2;
}
message JoinRoomProcedureResponse
{}
message LeaveRoomProcedureRequest
{
	uint32 client_id = 1;
  uint32 room_id = 2;
}
message LeaveRoomProcedureResponse
{}

enum RoomEventType 
{
	ROOM_EVENT_TYPE_UNSPECIFIED = 0;
  ROOM_EVENT_TYPE_USER_JOINED = 1;
  ROOM_EVENT_TYPE_USER_LEFT = 2;
  ROOM_EVENT_TYPE_ROOM_DELETED = 3;
  ROOM_EVENT_TYPE_ROOM_CREATED = 4;
}
message WatchRoomsStreamingRequest 
{
	uint32 room_id = 1;
  uint32 client_id = 2;
}
message WatchRoomsStreamingResponse
{
  RoomEventType type = 1;
  uint32 room_id = 2;
  RoomInfo room = 3;
  uint32 actor_id = 4; // rappresenta l'utente che compie l'azione
}

enum RoomUserEventType 
{
  ROOM_USER_EVENT_TYPE_UNSPECIFIED = 0;
  ROOM_USER_EVENT_TYPE_SNAPSHOT = 1;
  ROOM_USER_EVENT_TYPE_JOINED = 2;
  ROOM_USER_EVENT_TYPE_LEFT = 3;
}
message WatchRoomUsersStreamingRequest 
{
  uint32 room_id = 1;
  uint32 client_id = 2;
}
message WatchRoomUsersStreamingResponse 
{
  RoomUserEventType type = 1;
  uint32 room_id = 2;
  uint32 client_id = 3;
}